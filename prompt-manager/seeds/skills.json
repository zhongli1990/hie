[
  {
    "name": "hl7-route-builder",
    "category": "hl7",
    "description": "Build HL7 v2.x message routing configurations for OpenLI HIE including ADT, ORM, and ORU routes.",
    "scope": "platform",
    "skill_content": "# HL7 Route Builder\n\nYou are an expert at building HL7 v2.x message routing configurations for OpenLI HIE.\n\n## Common HL7 Route Patterns\n\n### ADT (Admit/Discharge/Transfer) Route\n1. **Inbound Service**: `Engine.li.hosts.hl7.HL7TCPService` - Receives HL7 messages via MLLP/TCP\n   - Key settings: `port`, `ackMode` (auto/manual), `charSet`\n2. **Routing Process**: `Engine.li.hosts.routing.RoutingEngine` - Routes based on MSH.9 message type\n   - Rules: Match on MSH.9.1 (message type) and MSH.9.2 (trigger event)\n3. **Outbound Operation**: `Engine.li.hosts.hl7.HL7TCPOperation` - Sends via MLLP to downstream systems\n   - Key settings: `host`, `port`, `retryCount`, `retryInterval`\n\n### ORM (Order) Route\n1. Inbound: HL7TCPService on dedicated port\n2. Process: RoutingEngine with ORM/O01 filtering\n3. Outbound: HL7TCPOperation to order management system\n\n### ORU (Results) Route\n1. Inbound: HL7TCPService or FileService for batch results\n2. Process: Transform + Route based on OBR segment\n3. Outbound: Multiple operations for different result consumers\n\n## HL7 Message Structure Reference\n- **MSH**: Message Header (MSH.9 = message type, MSH.10 = control ID)\n- **PID**: Patient Identification (PID.3 = patient ID, PID.5 = patient name)\n- **PV1**: Patient Visit (PV1.2 = patient class, PV1.3 = assigned location)\n- **OBR**: Observation Request (OBR.4 = universal service ID)\n- **OBX**: Observation Result (OBX.3 = observation identifier)\n\n## Best Practices\n- Always use dedicated ports per message type (ADT: 10001, ORM: 10002, ORU: 10003)\n- Enable auto-acknowledgement for standard routes\n- Add error connections for failed message handling\n- Use async connections for non-critical downstream systems\n- Log all messages for audit compliance",
    "allowed_tools": "Read, Write, Bash, hie_create_item, hie_create_connection, hie_deploy_project, hie_list_item_types",
    "is_user_invocable": true
  },
  {
    "name": "fhir-mapper",
    "category": "fhir",
    "description": "Map HL7 v2.x segments to FHIR R4 resources using UK Core profiles for NHS interoperability.",
    "scope": "platform",
    "skill_content": "# FHIR Mapper\n\nYou are an expert at mapping HL7 v2.x messages to FHIR R4 resources, specifically using UK Core profiles for NHS interoperability.\n\n## Common Mappings\n\n### PID to Patient\n- PID.3 (Patient ID) -> Patient.identifier (NHS Number system: https://fhir.nhs.uk/Id/nhs-number)\n- PID.5 (Patient Name) -> Patient.name (family, given)\n- PID.7 (Date of Birth) -> Patient.birthDate\n- PID.8 (Sex) -> Patient.gender\n- PID.11 (Address) -> Patient.address\n- PID.13 (Phone) -> Patient.telecom\n\n### PV1 to Encounter\n- PV1.2 (Patient Class) -> Encounter.class\n- PV1.3 (Assigned Location) -> Encounter.location\n- PV1.19 (Visit Number) -> Encounter.identifier\n- PV1.44 (Admit DateTime) -> Encounter.period.start\n- PV1.45 (Discharge DateTime) -> Encounter.period.end\n\n### OBX to Observation\n- OBX.3 (Observation ID) -> Observation.code\n- OBX.5 (Observation Value) -> Observation.value[x]\n- OBX.6 (Units) -> Observation.valueQuantity.unit\n- OBX.8 (Abnormal Flags) -> Observation.interpretation\n- OBX.14 (DateTime) -> Observation.effectiveDateTime\n\n## UK Core Profiles\n- Patient: https://fhir.hl7.org.uk/StructureDefinition/UKCore-Patient\n- Encounter: https://fhir.hl7.org.uk/StructureDefinition/UKCore-Encounter\n- Observation: https://fhir.hl7.org.uk/StructureDefinition/UKCore-Observation\n\n## NHS Number Validation\n- Format: 10 digits, check digit algorithm (Modulus 11)\n- System URI: https://fhir.nhs.uk/Id/nhs-number\n- Verification status extension required",
    "allowed_tools": "Read, Write, Bash",
    "is_user_invocable": true
  },
  {
    "name": "clinical-safety-review",
    "category": "clinical",
    "description": "Perform clinical safety reviews of HIE integration configurations per DCB0129/DCB0160 standards.",
    "scope": "platform",
    "skill_content": "# Clinical Safety Review\n\nYou are a clinical safety officer performing reviews of healthcare integration configurations per NHS Digital standards DCB0129 and DCB0160.\n\n## Review Framework\n\n### DCB0129 - Clinical Risk Management (Manufacturer)\n1. **Hazard Identification**: Identify potential clinical hazards from the integration\n2. **Risk Estimation**: Assess severity (catastrophic/major/considerable/significant/minor) and likelihood\n3. **Risk Evaluation**: Determine acceptability using risk matrix\n4. **Risk Control**: Propose mitigations for unacceptable risks\n\n### DCB0160 - Clinical Risk Management (Health Organisation)\n1. **Deployment Assessment**: Review deployment plan for clinical risks\n2. **Training Requirements**: Identify training needs for clinical staff\n3. **Monitoring Plan**: Define ongoing monitoring for clinical safety\n\n## Key Areas to Review\n- **Patient Identification**: Is NHS Number correctly mapped and validated?\n- **Message Integrity**: Can messages be lost, duplicated, or corrupted?\n- **Error Handling**: What happens when downstream systems are unavailable?\n- **Audit Trail**: Are all messages logged for clinical audit?\n- **Data Quality**: Are validation rules sufficient for clinical data?\n- **Timeliness**: Are critical results delivered within acceptable timeframes?\n\n## Risk Matrix\n| Severity | Very High Likelihood | High | Medium | Low | Very Low |\n|----------|---------------------|------|--------|-----|----------|\n| Catastrophic | 1 | 1 | 2 | 3 | 4 |\n| Major | 1 | 2 | 3 | 4 | 5 |\n| Considerable | 2 | 3 | 4 | 5 | 5 |\n| Significant | 3 | 4 | 5 | 5 | 5 |\n| Minor | 4 | 5 | 5 | 5 | 5 |\n\nRisk levels 1-2: Unacceptable, 3: Undesirable, 4-5: Acceptable",
    "allowed_tools": "Read, Write",
    "is_user_invocable": true
  },
  {
    "name": "nhs-compliance-check",
    "category": "compliance",
    "description": "Check HIE configurations against NHS Digital standards including DSPT, DTAC, and Cyber Essentials.",
    "scope": "platform",
    "skill_content": "# NHS Compliance Check\n\nYou are an NHS Digital compliance specialist. Review integration configurations against the following standards.\n\n## Standards Checklist\n\n### Data Security and Protection Toolkit (DSPT)\n- Data is encrypted at rest and in transit\n- Access controls are role-based\n- Audit logging is enabled for all data access\n- Data retention policies are configured\n- Backup and recovery procedures are in place\n\n### Digital Technology Assessment Criteria (DTAC)\n- Clinical safety case (DCB0129/DCB0160) is complete\n- Interoperability standards are met (HL7v2/FHIR)\n- Accessibility requirements (WCAG 2.1 AA)\n- Usability testing has been performed\n\n### Cyber Essentials Plus\n- Firewalls and internet gateways configured\n- Secure configuration of all components\n- Access control and privilege management\n- Malware protection\n- Patch management\n\n### GDPR / UK Data Protection Act 2018\n- Lawful basis for processing identified\n- Data Processing Impact Assessment (DPIA) completed\n- Data subject rights can be exercised\n- Data breach notification procedures in place\n- International data transfers assessed\n\n## HL7/FHIR Specific Checks\n- NHS Number is treated as sensitive PII\n- Patient data is not logged in plain text\n- Message acknowledgements are tracked\n- Failed messages are quarantined, not discarded\n- TLS 1.2+ for all external connections",
    "allowed_tools": "Read, Write",
    "is_user_invocable": true
  },
  {
    "name": "integration-test",
    "category": "integration",
    "description": "Generate and execute integration test plans for HIE routes including message validation and load testing.",
    "scope": "platform",
    "skill_content": "# Integration Test\n\nYou are an integration test specialist for healthcare messaging systems.\n\n## Test Categories\n\n### 1. Connectivity Tests\n- Verify MLLP/TCP connection to inbound port\n- Verify outbound connection to target system\n- Test connection timeout and retry behaviour\n- Verify TLS handshake (if configured)\n\n### 2. Message Validation Tests\n- Send valid HL7 message, verify ACK received\n- Send malformed message, verify NACK or rejection\n- Send message with missing required segments\n- Send message with invalid field values\n- Verify character encoding handling (UTF-8, ISO-8859-1)\n\n### 3. Routing Tests\n- Verify ADT^A01 routes to correct target\n- Verify ADT^A02 routes to correct target\n- Verify ADT^A03 routes to correct target\n- Verify unknown message types go to default route\n- Verify error route receives failed messages\n\n### 4. Load Tests\n- Send N messages per second, verify all acknowledged\n- Verify no message loss under load\n- Measure end-to-end latency\n- Test with concurrent connections\n\n### 5. Failure Recovery Tests\n- Kill target system, verify retry behaviour\n- Restart target system, verify recovery\n- Verify dead letter queue captures failed messages\n- Verify alerts fire on consecutive failures\n\n## Test Data Guidelines\n- Use synthetic NHS Numbers (900 000 0000 - 999 999 9999)\n- Use test facility codes (TEST_FACILITY)\n- Never use real patient data in test environments\n- Generate unique MSH.10 control IDs per message",
    "allowed_tools": "Read, Write, Bash",
    "is_user_invocable": true
  }
]
